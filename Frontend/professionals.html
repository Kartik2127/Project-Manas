<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Professionals | Project Manas</title>
  <link rel="stylesheet" href="professionals.css" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Tab Styles */
    .tabs-container {
      display: flex; justify-content: center; gap: 20px; margin: 20px 0;
    }
    .tab-btn {
      padding: 10px 25px; background: #f0f0f0; border: none; border-radius: 25px;
      font-size: 1rem; cursor: pointer; transition: 0.3s; font-weight: bold;
    }
    .tab-btn.active { background: #0077b6; color: white; }

    /* Hide/Show Sections */
    .hidden { display: none; }

    /* Expert Card Specifics */
    .expert-card { border-top: 4px solid #be185d; }
    .expert-role { color: #be185d; font-weight: bold; margin-bottom: 5px; }
    .expert-meta { font-size: 0.9rem; color: #666; margin-bottom: 15px; }
    
    .btn-book {
      background: #be185d; color: white; border: none; padding: 8px 16px;
      border-radius: 5px; cursor: pointer; width: 100%; margin-top: 5px;
    }
    .btn-call {
      background: white; border: 1px solid #be185d; color: #be185d;
      padding: 8px 16px; border-radius: 5px; cursor: pointer; width: 100%;
    }
  </style>
</head>

<body>

<header class="navbar">
  <div class="logo">Project Manas</div>
  <nav class="nav-links">
    <a href="index.html">Home</a>
    <a href="forum.html">Forum</a>
    <a href="stories.html">Stories</a>
    <a href="chatbot.html">Chatbot</a>
    <a href="student_inbox.html" class="nav-inbox">Inbox</a>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </nav>
</header>

<section class="professionals-section">
  <h1>Find Support</h1>
  <p class="subtitle">Choose the type of support that feels right for you.</p>

  <div class="tabs-container">
    <button class="tab-btn active" onclick="switchTab('mentors')">Peer Mentors</button>
    <button class="tab-btn" onclick="switchTab('experts')">Medical Professionals</button>
  </div>

  <div id="mentorList" class="mentor-list">
    <p style="text-align:center; width:100%;">Loading mentors...</p>
  </div>

  <div id="expertList" class="mentor-list hidden">
    </div>

  <div class="ai-section">
    <h2>Not ready to talk to a person?</h2>
    <p>Try Manas AI for a private, judgement-free conversation.</p>
    <button class="ai-btn" onclick="goToAI()">Talk to Manas AI</button>
  </div>

</section>

<script>
/* -----------------------------------
   1. AUTH & TABS
----------------------------------- */
const username = localStorage.getItem("username");
if(!username) window.location.href = "login.html";

function switchTab(tabName) {
    // Toggle Buttons
    const btns = document.querySelectorAll('.tab-btn');
    btns[0].classList.toggle('active', tabName === 'mentors');
    btns[1].classList.toggle('active', tabName === 'experts');

    // Toggle Lists
    document.getElementById('mentorList').classList.toggle('hidden', tabName !== 'mentors');
    document.getElementById('expertList').classList.toggle('hidden', tabName !== 'experts');
}

/* -----------------------------------
   2. LOAD REAL MENTORS (API)
----------------------------------- */
async function loadMentors() {
    try {
        const res = await fetch("/mentors/all"); // Your server endpoint
        const data = await res.json();
        const list = document.getElementById("mentorList");
        list.innerHTML = "";

        if(data.mentors.length === 0) {
            list.innerHTML = "<p>No mentors registered yet.</p>";
            return;
        }

        data.mentors.forEach(m => {
            const card = document.createElement("div");
            card.className = "mentor-card";
            card.innerHTML = `
                <div class="mentor-info">
                    <h2 class="mentor-name">${m.name}</h2>
                    <p class="role">${m.occupation}</p>
                    <p class="description">${m.bio}</p>
                    <p class="meta"><strong>Joined:</strong> Recent</p>
                </div>
                <div class="actions">
                    <button class="chat-btn" onclick="startPrivateChat('${m.email}', '${m.name}')">
                        Start Private Chat
                    </button>
                </div>
            `;
            list.appendChild(card);
        });
    } catch(err) {
        console.error(err);
    }
}

/* -----------------------------------
   3. LOAD DUMMY EXPERTS (Static)
----------------------------------- */
const experts = [
    { name: "Dr. Anjali Desai", role: "Clinical Psychologist", exp: "10 Yrs", loc: "Mumbai", fees: "‚Çπ1500/hr" },
    { name: "Dr. Rajesh Kumar", role: "Psychiatrist", exp: "15 Yrs", loc: "Delhi", fees: "‚Çπ2000/hr" },
    { name: "Ms. Sneha Roy", role: "Therapist", exp: "5 Yrs", loc: "Bangalore", fees: "‚Çπ1000/hr" },
    { name: "Dr. Vikram Sethi", role: "Trauma Specialist", exp: "12 Yrs", loc: "Pune", fees: "‚Çπ1800/hr" }
];

function loadExperts() {
    const list = document.getElementById("expertList");
    list.innerHTML = "";

    experts.forEach(doc => {
        const card = document.createElement("div");
        card.className = "mentor-card expert-card"; // Add extra class for styling
        card.innerHTML = `
            <div class="mentor-info">
                <h2 class="mentor-name">${doc.name}</h2>
                <p class="expert-role">${doc.role}</p>
                <p class="expert-meta">üìç ${doc.loc} ‚Ä¢ üíº ${doc.exp}</p>
                <p class="description">Specializes in anxiety, depression, and student mental health.</p>
                <p class="meta"><strong>Fees:</strong> ${doc.fees}</p>
            </div>
            <div class="actions">
                <button class="btn-book" onclick="alert('Appointment request sent to ${doc.name}!')">Book Appointment</button>
                <button class="btn-call" onclick="alert('Calling ${doc.name}...')">Schedule Call</button>
            </div>
        `;
        list.appendChild(card);
    });
}

/* -----------------------------------
   4. START CHAT LOGIC
----------------------------------- */
async function startPrivateChat(mentorEmail, mentorName) {
    const student = localStorage.getItem("username");
    
    const formData = new FormData();
    formData.append("student_username", student);
    formData.append("mentor_email", mentorEmail);

    try {
        const res = await fetch("/chat/start", {
            method: "POST",
            body: formData
        });
        const data = await res.json();

        localStorage.setItem("currentChatId", data.chat_id);
        localStorage.setItem("chatPartner", mentorName);
        localStorage.setItem("role", "student");

        window.location.href = "chat.html";
    } catch(err) {
        alert("Error starting chat");
    }
}

function goToAI() { window.location.href = "chatbot.html"; }
function logout() { localStorage.clear(); window.location.href = "login.html"; }

// Initialize
loadMentors();
loadExperts();
</script>
<script src="auth.js"></script>
</body>
</html>